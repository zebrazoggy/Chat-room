<!DOCTYPE html>
<html>
<body>

<div id="chat-wrap">
<h1>Chat Window</h1>
<div id="user-name"></div>
<div id="chat-box"><div id="chat-row"></div></div>
<form id="send-message-area">
<p>Your Message: </p>
<textarea id="posttext" maxlength="120"></textarea>
</form>
</div>
<script>
function Chat () {
/* call update chat function */
this.update = updateChat;
/* call send chat function */
this.send = sendChat;
/* call get state function */
this.getState = getState;
}
//define get state function
function getState() {
if(!instanse){
instanse = true;
/* define AJAX function */
$.ajax({
type: "POST",
url: "ajax.php",
data: {'function': 'getState', 'file': file},
dataType: "json",  
success: function(data) {state = data.state;instanse = false;}
});
}
}
//define update chat function
function updateChat() {
if(!instanse){
instanse = true;
/* define AJAX function */
$.ajax({
type: "POST",
url: "ajax.php",
data: {'function': 'update','state': state,'file': file},
dataType: "json",
success: function(data) {
if(data.text){
/* manage data */
for (var i = 0; i < data.text.length; i++) {
$('#chat-row').append($("
"+ data.text[i] +"
"));
}  
}
/* manage position of current chat */
document.getElementById('chat-row').scrollTop = document.getElementById('chat-row').scrollHeight;
instanse = false;
state = data.state;
}
});
}
else {
setTimeout(updateChat, 1000);
}
}
//define send chat function
function sendChat(msg, name) { 
updateChat();
/* define AJAX function */
$.ajax({
type: "POST",
url: "ajax.php",
/* manage message */
data: {'function': 'send','message': msg,'nickname': name,'file': file},
dataType: "json",
success: function(data){
updateChat();
}
});
}

</script>

